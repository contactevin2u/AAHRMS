<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no, viewport-fit=cover" />

    <!-- PWA Meta Tags -->
    <meta name="theme-color" content="#e91e63" />
    <meta name="description" content="Mimix Staff Clock In - Employee attendance system" />
    <meta name="mobile-web-app-capable" content="yes" />
    <meta name="application-name" content="Staff Clock" />

    <!-- iOS PWA Meta Tags -->
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
    <meta name="apple-mobile-web-app-title" content="Staff Clock" />

    <!-- iOS Splash Screens -->
    <link rel="apple-touch-startup-image" href="/icons/splash-640x1136.png" media="(device-width: 320px) and (device-height: 568px) and (-webkit-device-pixel-ratio: 2)" />
    <link rel="apple-touch-startup-image" href="/icons/splash-750x1334.png" media="(device-width: 375px) and (device-height: 667px) and (-webkit-device-pixel-ratio: 2)" />
    <link rel="apple-touch-startup-image" href="/icons/splash-1242x2208.png" media="(device-width: 414px) and (device-height: 736px) and (-webkit-device-pixel-ratio: 3)" />
    <link rel="apple-touch-startup-image" href="/icons/splash-1125x2436.png" media="(device-width: 375px) and (device-height: 812px) and (-webkit-device-pixel-ratio: 3)" />

    <!-- App Icons -->
    <link rel="icon" type="image/png" sizes="32x32" href="/icons/icon-32x32.png" />
    <link rel="icon" type="image/png" sizes="16x16" href="/icons/icon-16x16.png" />
    <link rel="apple-touch-icon" href="/icons/icon-180x180.png" />
    <link rel="apple-touch-icon" sizes="152x152" href="/icons/icon-152x152.png" />
    <link rel="apple-touch-icon" sizes="180x180" href="/icons/icon-180x180.png" />
    <link rel="apple-touch-icon" sizes="167x167" href="/icons/icon-167x167.png" />

    <!-- PWA Manifest -->
    <link rel="manifest" href="/manifest.json" />

    <!-- Preconnect for performance -->
    <link rel="preconnect" href="https://hrms-backend-1alt.onrender.com" />

    <!-- Prevent phone number detection -->
    <meta name="format-detection" content="telephone=no" />

    <title>AA HRMS</title>

    <style>
      /* Critical CSS for faster initial paint */
      body {
        margin: 0;
        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
        -webkit-font-smoothing: antialiased;
        -moz-osx-font-smoothing: grayscale;
        background-color: #f5f5f5;
      }

      /* iOS safe area support */
      body {
        padding: env(safe-area-inset-top) env(safe-area-inset-right) env(safe-area-inset-bottom) env(safe-area-inset-left);
      }

      /* Loading indicator */
      #loading-screen {
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: linear-gradient(135deg, #e91e63 0%, #ff5722 100%);
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        z-index: 9999;
      }

      #loading-screen.hidden {
        display: none;
      }

      .loading-logo {
        width: 80px;
        height: 80px;
        margin-bottom: 20px;
        animation: pulse 1.5s ease-in-out infinite;
      }

      .loading-text {
        color: white;
        font-size: 18px;
        font-weight: 500;
      }

      .loading-spinner {
        width: 40px;
        height: 40px;
        border: 3px solid rgba(255,255,255,0.3);
        border-top-color: white;
        border-radius: 50%;
        animation: spin 1s linear infinite;
        margin-top: 20px;
      }

      @keyframes spin {
        to { transform: rotate(360deg); }
      }

      @keyframes pulse {
        0%, 100% { transform: scale(1); }
        50% { transform: scale(1.05); }
      }

      /* Prevent pull-to-refresh on mobile */
      html, body {
        overscroll-behavior-y: contain;
      }
    </style>
  </head>
  <body>
    <noscript>You need to enable JavaScript to run this app.</noscript>

    <!-- Loading Screen -->
    <div id="loading-screen">
      <img src="/mixue-logo.png" alt="Loading" class="loading-logo" />
      <div class="loading-text">Loading...</div>
      <div class="loading-spinner"></div>
    </div>

    <div id="root"></div>

    <script>
      // Hide loading screen when app is ready
      window.addEventListener('load', function() {
        setTimeout(function() {
          var loader = document.getElementById('loading-screen');
          if (loader) {
            loader.classList.add('hidden');
          }
        }, 500);
      });

      // Register Service Worker
      if ('serviceWorker' in navigator) {
        window.addEventListener('load', function() {
          navigator.serviceWorker.register('/sw.js')
            .then(function(registration) {
              console.log('SW registered:', registration.scope);

              // Check for updates
              registration.addEventListener('updatefound', function() {
                var newWorker = registration.installing;
                newWorker.addEventListener('statechange', function() {
                  if (newWorker.state === 'installed' && navigator.serviceWorker.controller) {
                    // New content available, show refresh prompt
                    if (confirm('New version available! Refresh to update?')) {
                      window.location.reload();
                    }
                  }
                });
              });
            })
            .catch(function(error) {
              console.log('SW registration failed:', error);
            });
        });
      }

      // iOS install prompt helper
      var isIOS = /iPad|iPhone|iPod/.test(navigator.userAgent) && !window.MSStream;
      var isStandalone = window.matchMedia('(display-mode: standalone)').matches || window.navigator.standalone;

      if (isIOS && !isStandalone) {
        // Could show iOS install instructions
        console.log('iOS device detected - not in standalone mode');
      }
    </script>
  </body>
</html>
